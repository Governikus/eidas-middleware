package de.governikus.eumw.poseidas.server.timer;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import java.security.Security;
import java.util.Base64;

import org.apache.tomcat.util.http.fileupload.FileUtils;
import org.bouncycastle.jce.provider.BouncyCastleProvider;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.boot.web.context.WebServerInitializedEvent;

import de.governikus.eumw.poseidas.eidserver.crl.CertificationRevocationListImpl;
import de.governikus.eumw.poseidas.server.idprovider.config.CvcTlsCheck;
import de.governikus.eumw.poseidas.server.idprovider.config.PoseidasConfigurator;
import de.governikus.eumw.poseidas.server.pki.PermissionDataHandling;
import de.governikus.eumw.poseidas.server.pki.TerminalPermission;
import de.governikus.eumw.poseidas.server.pki.TerminalPermissionAO;
import lombok.extern.slf4j.Slf4j;


@Slf4j
@ExtendWith(MockitoExtension.class)
class StartupListenerTest
{

  private static final String MASTERLIST_BASE64 = "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";

  private static final String JAVA_IO_TMPDIR = System.getProperty("java.io.tmpdir") + "/poseidas";

  private static String tempDirectory;

  @Mock
  private PermissionDataHandling permissionDataHandling;

  @Mock
  private TerminalPermissionAO facade;

  @Mock
  private CvcTlsCheck cvcTlsCheck;

  @Mock
  private WebServerInitializedEvent webServerInitializedEvent;

  StartupListener startupListener;

  @BeforeAll
  public static void setUp()
  {
    Security.addProvider(new BouncyCastleProvider());
    PoseidasConfigurator.reset();
  }

  @AfterEach
  public void reset() throws IOException
  {
    PoseidasConfigurator.reset();
    CertificationRevocationListImpl.reset();
    FileUtils.deleteDirectory(new File(tempDirectory));
    log.trace("Deleted random temp dir: {}", tempDirectory);
  }


  @Test
  void testWhenTerminalPermissionIsNullThenCRLNotInitialized() throws Exception
  {
    tempDirectory = JAVA_IO_TMPDIR + "-" + (int)(Math.random() * 1000000);
    Files.createDirectory(Paths.get(tempDirectory));
    log.trace("Generated random temp dir: {}", tempDirectory);
    Path resourceDirectory = Paths.get("src", "test", "resources");
    File source = new File(resourceDirectory + "/POSeIDAS.xml");
    File dest = new File(tempDirectory + "/POSeIDAS.xml");
    Files.copy(source.toPath(), dest.toPath(), StandardCopyOption.REPLACE_EXISTING);
    System.setProperty("spring.config.additional-location", Paths.get(tempDirectory).toString());
    startupListener = new StartupListener(permissionDataHandling, facade, cvcTlsCheck);
    startupListener.onApplicationEvent(webServerInitializedEvent);

    Mockito.verify(permissionDataHandling, Mockito.times(1)).renewMasterAndDefectList();
    Assertions.assertThrows(IllegalStateException.class, CertificationRevocationListImpl::getInstance);
    Mockito.verify(cvcTlsCheck, Mockito.times(1)).check();

  }

  @Test
  void testWhenMasterlistPresentThenCRLInitialized() throws Exception
  {
    tempDirectory = JAVA_IO_TMPDIR + "-" + (int)(Math.random() * 1000000);
    Files.createDirectory(Paths.get(tempDirectory));
    log.trace("Generated random temp dir: {}", tempDirectory);
    Path resourceDirectory = Paths.get("src", "test", "resources");
    File source = new File(resourceDirectory + "/POSeIDAS.xml");
    File dest = new File(tempDirectory + "/POSeIDAS.xml");
    Files.copy(source.toPath(), dest.toPath(), StandardCopyOption.REPLACE_EXISTING);
    System.setProperty("spring.config.additional-location", Paths.get(tempDirectory).toString());
    startupListener = new StartupListener(permissionDataHandling, facade, cvcTlsCheck);
    TerminalPermission terminalPermission = Mockito.mock(TerminalPermission.class);
    Mockito.when(facade.getTerminalPermission(Mockito.anyString())).thenReturn(terminalPermission);
    Mockito.when(terminalPermission.getMasterList())
           .thenReturn(Base64.getDecoder().decode(MASTERLIST_BASE64));
    startupListener.onApplicationEvent(webServerInitializedEvent);

    Mockito.verify(permissionDataHandling, Mockito.times(1)).renewMasterAndDefectList();
    Assertions.assertNotNull(CertificationRevocationListImpl.getInstance());
    Mockito.verify(cvcTlsCheck, Mockito.times(1)).check();
  }
}
